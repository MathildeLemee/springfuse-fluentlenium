<?xml version="1.0" encoding="UTF-8"?>
<!--
 ! (c) Copyright 2005-2011 JAXIO, www.jaxio.com
 ! Source code generated by Celerio, a Jaxio product
 ! Want to use Celerio within your company? email us at info@jaxio.com
 ! Follow us on twitter: @springfuse
 ! Template pack-jsf2-primefaces:src/main/webapp/WEB-INF/flows/select/selectFlow.e.vm.xml
-->
<flow xmlns="http://www.springframework.org/schema/webflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
	<persistence-context />
    
    <!-- * sub: opened from another edit flow, generally to select the target entity of a many-to-one association -->
	<input name="sub" type="boolean" value="flowScope.sub"/>

	<decision-state id="selectChoice">
		<if test="sub" then="addressSubSelect" else="addressSelect" />
	</decision-state>

	<view-state id="addressSelect" parent="#addressSelectCommon">
        <on-render>
            <evaluate expression="flowsMenuHandler.updateMenu(flowRequestContext,'select')" /> 
        </on-render>    
	</view-state>

    <view-state id="addressSubSelect" parent="#addressSelectCommon">
    </view-state>

    <view-state id="addressSelectCommon">
        <on-entry>
            <!-- Force search to get some data to present to the user immediately -->
            <evaluate expression="addressSearchForm.lazyDataModel" result="viewScope.addresses" />
        </on-entry>
        <transition on="search">
            <evaluate expression="addressSearchForm.lazyDataModel" result="viewScope.addresses" />
            <render fragments="form:searchResults"/>
        </transition>        
    </view-state>
    
	<!-- ========== -->
	<!-- END STATES -->
	<!-- ========== -->
	<!-- Default end state -->
	<end-state id="addressSelected">
		<output name="addressSelected" value="addressSelected" />
	</end-state>
	<!-- End state for menu actions -->
	<end-state id="new" />
	<end-state id="quit" />
	<end-state id="error" />
	<end-state id="cancel" />
	<global-transitions>
		<transition on="select" to="addressSelected" validate="false">
			<set name="flowScope.addressSelected" value="addresses.selectedRow" />
		</transition>
		<transition on="cancel" to="cancel" validate="false" />
		<transition on="sendNew" to="new" validate="false" />
		<transition on="quit" to="quit" validate="false" />
		<transition on="debugThrowException">
			<evaluate expression="exceptionUtil.throwRuntimeException()" />
		</transition>
		<transition on-exception="java.lang.RuntimeException" to="error" />
	</global-transitions>
</flow>